

Takes 0.41 seconds with `pick_sim<-` and 0.004 seconds with
`[<-`. Could write process_call to use `[<-`.

```{r}
test <- array(dim = c(4000, 4, 1))
test2 <- array(1:4, c(4, 1))
system.time(for (i in 1:4000) pick_sim(test, i) <- test2)
system.time(for (i in 1:4000) test[i, , ] <- test2)
```


# Environment implementation

Would creating nsims environments in container_env and looping over
these environments be efficient? Probably not.

0.025 seconds to create 4000 environments.
0.03 seconds to create an empty 4x1 array in all sim env
0.02 seconds to assign array in all sims

```{r}
test <- new.env()
system.time(for (i in 1:4000) assign(paste0("sim", i), new.env(), envir = test))
system.time(for (i in 1:4000) eval(quote(test <- test2), test[[paste0("sim", i)]]))
```


# Array implementation

Could have some kind of hybrid evaluation in which binary ops such
as + or - would be recognized.


# Task merging

Task merging is not extremely helpful. It probably is important to
merge everything in the rhs of an assignment though.

```{r}
microbenchmark(t1 = {
  for (i in 1:4000)
    fitted_logit[i, ] <- X %*% cbind(sims2$beta[i, ])
  for (i in 1:4000)
    testouille[i, ] <- fitted_logit[i, ] + fitted_logit[i, ]
}, t2 = {
  for (i in 1:4000) {
    fitted_logit[i, ] <- X %*% cbind(sims2$beta[i, ])
    testouille[i, ] <- fitted_logit[i, ] + fitted_logit[i, ]
  }, times = 5
)
```

t1 performed in 1260 ms, and t2 in 1100 ms
